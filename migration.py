import json
from tqdm import tqdm

map_convert = {
    "ayutthaya": "Ayutthaya",
    "blackforest": "Black Forest",
    "blizzardworld": "Blizzard World",
    "busan": "Busan",
    "castillo": "Castillo",
    "chateauguillard": "Chateau Guillard",
    "dorado": "Dorado",
    "eichenwalde": "Eichenwalde",
    "hanamura": "Hanamura",
    "havana": "Havana",
    "hollywood": "Hollywood",
    "horizonlunarcolony": "Horizon Lunar Colony",
    "ilios": "Ilios",
    "junkertown": "Junkertown",
    "lijiangtower": "Lijiang Tower",
    "malevento": "Malevento",
    "necropolis": "Necropolis",
    "nepal": "Nepal",
    "numbani": "Numbani",
    "oasis": "Oasis",
    "paris": "Paris",
    "rialto": "Rialto",
    "route66": "Route 66",
    "templeofanubis": "Temple of Anubis",
    "volskayaindustries": "Volskaya Industries",
    "watchpointgibraltar": "Watchpoint: Gibraltar",
    "kingsrow": "King's Row",
    "petra": "Petra",
    "ecopointantarctica": "Ecopoint: Antarctica",
    "kanezaka": "Kanezaka",
    "workshopchamber": "Workshop Chamber",
    "workshopexpanse": "Workshop Expanse",
    "workshopgreenscreen": "Workshop Greenscreen",
    "workshopisland": "Workshop Island",
    "practicerange": "Practice Range",
    "framework": "Framework",
}

type_convert = {
    "SINGLE": "Single",
    "MULTILEVEL": "Multilevel",
    "PIONEER": "Pioneer",
    "TIME-ATTACK": "Time Attack",
    "MEGAMAP": "Megamap",
    "MULTIMAP": "Multimap",
    "TUTORIAL": "Tutorial",
    "HARDCORE": "Hardcore",
    "MILDCORE": "Mildcore",
    "OUT-OF-MAP": "Out of Map",
    "ABLOCK": "Ability Lock",
    "NOSTALGIA": "Nostalgia",
    "FRAMEWORK": "Framework",
    "DIVERGE": "Diverge",
    "BONUS": "Bonus",
    "TOURNAMENT": "Tournament"
}


conversions_ = {
    "762198382676017200": "762198382676017212",
    "353400377481232400": "353400377481232385", #
    "402517838671249400": "402517838671249408", #
    "362072248137416700": "362072248137416706", #
    "252342653990076400": "252342653990076417", #
    "574804014399750140": "574804014399750164", #
    "693865610979049500": "693865610979049483", #
    "754659767477207000": "754659767477207060", #
    "657231013763743700": "657231013763743751", #
    "652901872692101100": "652901872692101126", #
    "371584174399946750": "371584174399946754", #
    "345232492145672200": "345232492145672193", #
    "203853691328004100": "203853691328004096", #
    "139240029812686850": "139240029812686848", #
    "445035241460203500": "445035241460203520", #
    "187340057462439940": "187340057462439951",
    "382183842796011500": "382183842796011530",
    "364735508385103900": "364735508385103883",
    "825262786175172600": "825262786175172628",
    "343862912630259700": "343862912630259714",
    "145194995031212030": "145194995031212032",
    "265573813662646270": "265573813662646274",
    "428305327109439550": "428305327109439528",
    "637782279552368600": "637782279552368641",
    "616422304515227600": "616422304515227649",
    "107991263248150530": "107991263248150528",
    "235471338536435700": "235471338536435713",
    "138711321804800000": "138711321804800001",
    "368482858479910900": "368482858479910922",
    "146244622870380540": "146244622870380544",
    "705167667077840900": "705167667077840906",
    "135661653315420160": "135661653315420160",
    "723655200782680200": "723655200782680206",
    "244507811583623170": "244507811583623170",
    "687322655543918700": "687322655543918728",
    "231077450749050880": "231077450749050880",
    "535026711830593540": "535026711830593537",
    "890445107856310300": "890445107856310322",
    "236956119602298880": "236956119602298881",
    "906753904287576000": "906753904287576085",
    "893556516437766100": "893556516437766174",
    "273465062516326400": "273465062516326401",
    "814874642111267000": "814874642111266896",
    "326983993180291100": "326983993180291073",
    "147164404591493120": "147164404591493120",
    "198909436146876400": "198909436146876419",
    "210374251352424450": "210374251352424448",
    "831475861123367000": "831475861123366994",
    "664483930816249900": "664483930816249878",
    "603663937262846000": "603663937262845961",
    "180790519062986750": "180790519062986752",
    "470119111838400500": "470119111838400522",
    "343408964651843600": "343408964651843585",
    "813528741066047500": "813528741066047488",
    "264545273689145340": "264545273689145346",
    "297831804642000900": "297831804642000916",
    "678275045050679300": "678275045050679321",
    "767499688311521300": "767499688311521280",
    "462305088124354560": "462305088124354560",
    "676876079629074400": "676876079629074432",
    "882391436371296300": "882391436371296266",
    "726369887143985200": "726369887143985182",
    "422712500199358460": "422712500199358475",
    "535190134497345540": "535190134497345566",
    "817229286901547000": "817229286901547018",
    "766322766211055600": "766322766211055627",
    "211123482874871800": "211123482874871808",
    "311636831898697700": "311636831898697730",
    "419295516615114750": "419295516615114762",
    "658494756732665900": "658494756732665877",
    "329766437159960600": "329766437159960584",
    "234724625337155600": "234724625337155585",
    "797320232074477600": "797320232074477579",
    "445972312030969860": "445972312030969868",
    "418111007282692100": "418111007282692096",
    "334969003824906240": "334969003824906241",
    "608090275885219800": "608090275885219851",
    "103377187465347070": "103377187465347072",
    "171534229832728580": "171534229832728576",
    "297646172485713900": "297646172485713920",
    "871090022391087100": "871090022391087164",
    "327826987622334460": "327826987622334465",
    "848055400552988700": "848055400552988703",
    "803594667375198200": "803594667375198208",
    "836288029924524000": "836288029924524063",
    "743915293583212500": "743915293583212544",
    "577323989161214000": "577323989161213953",
    "320260815452373000": "320260815452373023",
    "382477502796267500": "382477502796267521",
    "318677925404868600": "318677925404868608",
    "505754200354062340": "505754200354062336",
    "240664675103146000": "240664675103145988",
    "362645654075473900": "362645654075473921",
    "338375078205194240": "338375078205194240",
    "386099475573375000": "386099475573374978",
    "544161037176406000": "544161037176406018",
    "525448201495380000": "525448201495379969",
    "386444551491026940": "386444551491026946",
    "187699159460085760": "187699159460085761",
    "248892037804458000": "248892037804457984",
    "542537230762377200": "542537230762377217",
    "568142017193050100": "568142017193050122",
    "141372217677053950": "141372217677053952",
    "593838073012289500": "593838073012289536",
    "764235519395627000": "764235519395627038",
    "584469072171761700": "584469072171761666",
    "403564900414259200": "403564900414259200",
    "497204377715736600": "497204377715736576",
    "702959707249180700": "702959707249180683",
    "398329559445012500": "398329559445012481",
    "360821403127119900": "360821403127119872",
    "126405419714347000": "126405419714347008",
    "843941774991950000": "843941774991949905",
    "294502010445758460": "294502010445758464",
    "287951444810661900": "287951444810661888",
    "625082256683171800": "625082256683171871",
    "306809785129369600": "306809785129369602",
    "696982291905511400": "696982291905511454",
    "134944251065794560": "134944251065794560",
    "571717879419109440": "571717879419109417",
    "272534095983018000": "272534095983017984",
    "543720258112978940": "543720258112978947",
    "": "141372217677053952",
}


print("Opening MapData.json")
with open("MapData.json", encoding="utf8") as f:
     data = json.load(f)

print("Beginning MapData.json conversion...")
# Migrate MapData.json
for doc in tqdm(data):
    # Change map
    doc['map_name'] = map_convert[doc["map_name"]]

    # fix truncated IDs/convert to int
    id_fix = conversions_.get(str(doc["posted_by"]))
    if id_fix:

        doc["posted_by"] = int(id_fix)
    else:
        doc["posted_by"] = int(doc["posted_by"])


    # Change types
    for i, type_ in enumerate(doc["type"]):
        doc["type"][i] = type_convert[type_]
    
    # rename desc
    doc["description"] = doc.pop("desc")
    # rename posted_by
    doc["user_id"] = doc.pop("posted_by")

print("Saving MapData_Converted.json..")
with open("MapData_Converted.json", "w") as f:
    json.dump(data, f)
print("Complete.")

# Records data migrate
print("Opening WorldRecords.json")
with open("WorldRecords.json", encoding="utf8") as f:
     data = json.load(f)

print("Beginning WorldRecords.json conversion...")
for doc in tqdm(data):
    # fix truncated IDs/convert to int
    id_fix = conversions_.get(str(doc["posted_by"]))
    if id_fix:

        doc["posted_by"] = int(id_fix)
    else:
        doc["posted_by"] = int(doc["posted_by"])

    # rename posted_by
    doc["user_id"] = doc.pop("posted_by")

    doc.pop("name")

print("Saving WorldRecords_Converted.json..")
with open("WorldRecords_Converted.json", "w") as f:
    json.dump(data, f)
